{"componentChunkName":"component---src-templates-blog-detail-js","path":"/blog/canvas-lucky-wheel","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"/blog/canvas-lucky-wheel\",\n  \"title\": \"canvas 转盘抽奖\",\n  \"date\": \"2020-06-15 16:57:55\",\n  \"brief\": \"转盘抽奖在移动端的应用中也十分常见。在 html5 中利用 canvas 便可绘制转盘，实现抽奖功能。\",\n  \"tag\": \"h5\",\n  \"cover\": \"1594093362995.png\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h3\", null, \"\\u6548\\u679C\\u9884\\u89C8\"), mdx(\"p\", null, \"\\u9759\\u6001\\u9875\\u9762\\u5C55\\u793A\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/1594093362995.png\",\n    \"alt\": \"转盘抽奖静态\"\n  })), mdx(\"p\", null, \"\\u52A8\\u6001\\u4EA4\\u4E92\\u64CD\\u4F5C\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/canvas-lucky-wheel.gif\",\n    \"alt\": \"转盘抽奖动态\"\n  })), mdx(\"h3\", null, \"\\u529F\\u80FD\\u63CF\\u8FF0\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u6A21\\u62DF\\u4ECE\\u540E\\u7AEF\\u63A5\\u53E3\\u83B7\\u53D6\\u7684\\u5956\\u54C1\\u6570\\u636E\\u53CA\\u4E2D\\u5956\\u6982\\u7387\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u652F\\u6301\\u591A\\u6B21\\u62BD\\u5956\\uFF08\\u8BBE\\u7F6E\\u6B21\\u6570\\u4E0A\\u9650\\uFF09\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u663E\\u793A\\u4E2D\\u5956\\u7684\\u5956\\u54C1\\u4FE1\\u606F\")), mdx(\"br\", null), mdx(\"h3\", null, \"\\u5B9E\\u73B0\\u96BE\\u70B9\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u6839\\u636E\\u8BBE\\u7F6E\\u7684\\u6982\\u7387\\u751F\\u6210\\u968F\\u673A\\u6570\\u8868\\u793A\\u62BD\\u5956\\u7ED3\\u679C\\uFF1F\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u901A\\u5E38\\u5728 javascript \\u4E2D\\u751F\\u6210\\u968F\\u673A\\u6570\\u90FD\\u662F\\u4F7F\\u7528 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Math.random()\"), \" \\u65B9\\u6CD5\\u6765\\u5B9E\\u73B0\\u7684\\uFF0C\\u4F46\\u8FD9\\u6837\\u751F\\u6210\\u7684\\u662F\\u7B49\\u6982\\u7387\\u7684\\u3002\\u56E0\\u6B64\\u6B64\\u5904\\u9700\\u8981\\u53E6\\u5199\\u7B97\\u6CD5\\u52A0\\u4EE5\\u5B9E\\u73B0\\u3002\\u5728\\u4EE3\\u7801\\u4E66\\u5199\\u4E2D\\uFF0C\\u501F\\u9274\\u4E86 \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.cnblogs.com/whnba/p/10214312.html\"\n  }, \"Js \\u63A7\\u5236\\u968F\\u673A\\u6570\\u6982\\u7387\"), \" \\u8FD9\\u7BC7\\u535A\\u5BA2\\u7684\\u65B9\\u6CD5\\u3002\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u968F\\u673A\\u6570\\u7684\\u7ED3\\u679C\\u4E0E\\u8F6C\\u76D8\\u533A\\u57DF\\u7684\\u5BF9\\u5E94\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u6BCF\\u4E2A\\u533A\\u57DF\\u9700\\u8981\\u8F6C\\u52A8\\u7684\\u89D2\\u5EA6\\u662F\\u786E\\u5B9A\\u7684\\uFF0C\\u901A\\u8FC7\\u968F\\u673A\\u6570\\u63A7\\u5236\\u6700\\u7EC8\\u65CB\\u8F6C\\u7684\\u89D2\\u5EA6\\u5373\\u53EF\\u3002\"))), mdx(\"br\", null), mdx(\"h3\", null, \"\\u6838\\u5FC3\\u6E90\\u7801\"), mdx(\"p\", null, \"html \\u90E8\\u5206\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-html\"\n  }, \"<div class=\\\"lucky\\\">\\n    <div class=\\\"lucky__wheel\\\">\\n    <canvas id=\\\"canvas\\\">\\u62B1\\u6B49\\uFF0C\\u5F53\\u524D\\u6D4F\\u89C8\\u5668\\u4E0D\\u652F\\u6301canvas</canvas>\\n  </div>\\n  <div class=\\\"lucky__pointer\\\" id=\\\"pointer\\\">\\n  </div>\\n</div>\\n\\n<!-- \\u4E2D\\u5956\\u6982\\u7387\\u516C\\u793A -->\\n<div class=\\\"pr\\\">\\n  <p class=\\\"pr__title\\\">\\u4E2D\\u5956\\u6982\\u7387\\u516C\\u793A</p>\\n  <div class=\\\"pr__list\\\"></div>\\n</div>\\n\\n<!-- \\u6B21\\u6570 & \\u62BD\\u4E2D\\u7684\\u5956\\u54C1 -->\\n<div class=\\\"result\\\">\\n  <div class=\\\"result__title\\\">\\n    \\u5269\\u4F59<strong class=\\\"result__count\\\" id=\\\"count\\\">0</strong>\\u6B21\\u62BD\\u5956\\u673A\\u4F1A\\n  </div>\\n  <ul class=\\\"result__prize\\\"></ul>\\n</div>\\n\")), mdx(\"p\", null, \"js \\u90E8\\u5206\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"\\\"use strict\\\";\\n\\nclass LuckyWheel {\\n  /**\\n   *\\n   * @param {*} oWheel \\u8F6C\\u76D8\\u5916\\u5706DOM\\n   * @param {*} oCanvas \\u8F6C\\u76D8Canvas DOM\\n   * @param {*} oPointer \\u6307\\u9488DOM\\n   * @param {Number} count \\u53EF\\u62BD\\u5956\\u603B\\u6B21\\u6570\\n   */\\n  constructor(oWheel, oCanvas, oPointer, count) {\\n    this.rem = Number.parseFloat(\\n      getComputedStyle(document.documentElement).fontSize\\n    )\\n\\n    // \\u753B\\u5E03\\u5143\\u7D20 & \\u8F6C\\u76D8\\u6307\\u9488\\n    this._wheelElm = oWheel\\n    this._canvasElm = oCanvas\\n    this._pointerElm = oPointer\\n\\n    // \\u753B\\u5E03\\u5C3A\\u5BF8\\n    this.width = oWheel.offsetHeight\\n    this.height = this.width\\n\\n    oCanvas.width = this.width\\n    oCanvas.height = this.height\\n    this.ctx = oCanvas.getContext('2d')\\n\\n    // \\u7ED8\\u5236\\u5404\\u4E2A\\u6247\\u5F62\\u989C\\u8272\\u677F\\u914D\\u8272\\n    this.colors = [\\n      '#AE3EFF',\\n      '#4D3FFF',\\n      '#FC262C',\\n      '#3A8BFF',\\n      '#EE7602',\\n      '#FE339F',\\n    ]\\n\\n    this.textRadius = 2 * this.rem // \\u6587\\u672C\\u6240\\u5728\\u7684\\u73AF\\u7684\\u534A\\u5F84\\n    this.outerRadius = 2.7 * this.rem // \\u5706\\u76D8\\u534A\\u5F84\\n    this.prizes = []\\n\\n    this.isRotating = false\\n\\n    // \\u8F6C\\u76D8\\u8F6C\\u52A8\\u89D2\\u5EA6\\n    this.wheelStatus = {\\n      rotate: 0,\\n    }\\n\\n    // \\u62BD\\u5956\\u7ED3\\u679C\\n    this.result = 0\\n\\n    // \\u5F53\\u524D\\u8F6E\\u6B21\\u6307\\u9488\\u505C\\u7559\\u4F4D\\u7F6E\\n    this.pointerTo = 4\\n\\n    // \\u5DF2\\u8F6C\\u52A8\\u6B21\\u6570\\n    this.count = 0\\n\\n    // \\u53EF\\u8F6C\\u52A8\\u603B\\u6B21\\u6570\\n    this.totalCount = count\\n\\n    // \\u8F6C\\u76D8\\u6BCF\\u6B21\\u8F6C\\u52A8\\u5B8C\\u6210\\u540E\\u7684\\u56DE\\u8C03\\u51FD\\u6570\\n    this.onRotateFinished = null\\n  }\\n\\n  // \\u7ED8\\u5236\\u6247\\u5F62\\u548C\\u5956\\u54C1\\n  render() {\\n    this.ctx.clearRect(0, 0, this.width, this.height)\\n\\n    const perFanAngle = (Math.PI * 2) / this.prizes.length\\n\\n    this.ctx.save()\\n    this.ctx.translate(this.width / 2, this.height / 2)\\n    this.ctx.rotate((this.wheelStatus.rotate / 180) * Math.PI)\\n\\n    for (var i = 0, len = prizes.length; i < len; i++) {\\n      let angle = i * perFanAngle\\n\\n      this.ctx.beginPath()\\n      this.ctx.moveTo(0, 0)\\n      this.ctx.arc(0, 0, this.outerRadius, angle, angle + perFanAngle, false)\\n      this.ctx.closePath()\\n      this.ctx.fillStyle = this.colors[i]\\n      this.ctx.fill()\\n\\n      this.ctx.save()\\n\\n      let translateX = Math.cos(angle + perFanAngle / 2) * this.textRadius\\n      let translateY = Math.sin(angle + perFanAngle / 2) * this.textRadius\\n      this.ctx.translate(translateX, translateY)\\n      this.ctx.rotate(angle + perFanAngle / 2 + Math.PI / 2)\\n      this.ctx.font = this.rem * 0.28 + 'px \\u9ED1\\u4F53'\\n      this.ctx.fillStyle = '#FFFF00'\\n      this.ctx.fillText(\\n        this.prizes[i].name,\\n        -this.ctx.measureText(prizes[i].name).width / 2,\\n        0\\n      )\\n\\n      this.ctx.restore()\\n    }\\n\\n    this.ctx.restore()\\n  }\\n\\n  rotate() {\\n    var rotateAngle =\\n      360 * 5 + (360 / this.prizes.length) * (this.pointerTo - this.result)\\n\\n    const _this = this\\n    var tween = new TWEEN.Tween(this.wheelStatus)\\n    tween\\n      .easing(TWEEN.Easing.Quadratic.InOut)\\n      .to({ rotate: rotateAngle + _this.wheelStatus.rotate }, 5000)\\n      .start()\\n      .onComplete(function (){\\n        _this.isRotating = false\\n        _this.pointerTo = this.result\\n\\n        let res = this.prizes[_this.result]\\n        _this.onRotateFinished && _this.onRotateFinished(res)\\n\\n        if (_this.count === _this.totalCount) {\\n          _this._pointerElm.classList.add('elm--disabled')\\n        }\\n      })\\n\\n    animate.call(this)\\n\\n    function animate() {\\n      requestAnimationFrame(animate.bind(this))\\n      TWEEN.update()\\n\\n      this.render()\\n    }\\n  }\\n\\n  // \\u6839\\u636E\\u6982\\u7387\\u751F\\u6210\\u968F\\u673A\\u6570\\n  generateRandom() {\\n    const len = this.prizes.length\\n\\n    const percents = this.prizes.map((item, index) => [index, item.pr])\\n\\n    const random = new RandomNum(0, len)\\n    random.percentage = new Map(percents)\\n\\n    random.range()\\n    // \\u62BD\\u5956\\u7ED3\\u679C\\n    this.result = random.create()\\n  }\\n\\n  init() {\\n    this.render()\\n\\n    // \\u70B9\\u51FB\\u62BD\\u5956\\n    this._pointerElm.addEventListener('click', () => {\\n      if (this.isRotating || this.count >= this.totalCount) return\\n\\n      this.isRotating = true\\n      this.count++\\n\\n      this.generateRandom()\\n\\n      this.rotate()\\n    })\\n  }\\n}\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"\\\"use strict\\\";\\n// \\u6A21\\u62DF\\u540E\\u7AEF\\u63A5\\u53E3\\u83B7\\u53D6\\u7684\\u6570\\u636E\\nconst prizes = [\\n  {\\n    id: 1,\\n    type: 1, // \\u662F\\u5426\\u4E2D\\u5956\\n    name: \\\"50\\u5143\\u62B5\\u6263\\u5238\\\",\\n    pr: 0.005, // \\u6982\\u7387\\n  },\\n  {\\n    id: 2,\\n    type: 0,\\n    name: \\\"\\u8C22\\u8C22\\u53C2\\u4E0E\\\",\\n    pr: 0.301,\\n  },\\n  {\\n    id: 3,\\n    type: 1,\\n    name: \\\"30\\u79EF\\u5206\\\",\\n    pr: 0.03,\\n  },\\n  {\\n    id: 4,\\n    type: 0,\\n    name: \\\"\\u8C22\\u8C22\\u53C2\\u4E0E\\\",\\n    pr: 0.301,\\n  },\\n  {\\n    id: 5,\\n    type: 1,\\n    name: \\\"10\\u79EF\\u5206\\\",\\n    pr: 0.062,\\n  },\\n  {\\n    id: 6,\\n    type: 0,\\n    name: \\\"\\u8C22\\u8C22\\u53C2\\u4E0E\\\",\\n    pr: 0.301,\\n  },\\n];\\n\\nwindow.onload = function () {\\n  const oCanvas = document.getElementById(\\\"canvas\\\"),\\n        oWheel = document.getElementsByClassName(\\\"lucky__wheel\\\")[0],\\n        oPointer = document.getElementById(\\\"pointer\\\");\\n  \\n  const oCount = document.getElementById(\\\"count\\\"),\\n        oResult = document.getElementsByClassName(\\\"result__prize\\\")[0];\\n  \\n  const oPrList = document.getElementsByClassName(\\\"pr__list\\\")[0];\\n  \\n  // \\u521D\\u59CB\\u5316\\u62BD\\u5956\\u6B21\\u6570\\n  oCount.innerText = 3;\\n  \\n  // \\u663E\\u793A\\u4E2D\\u5956\\u6982\\u7387\\u516C\\u793A\\n  let htmlStr = \\\"\\\";\\n  prizes.forEach((item) => {\\n    if (item.type === 1) {\\n      htmlStr += `<p>${item.name} <strong>${item.pr * 100}</strong>%</p>`;\\n    }\\n  });\\n  oPrList.innerHTML = htmlStr;\\n  const wheel = new LuckyWheel(oWheel, oCanvas, oPointer, 3);\\n  \\n  // \\u53EF\\u901A\\u8FC7\\u63A5\\u53E3\\u8BF7\\u6C42\\u83B7\\u53D6\\u6570\\u636E...\\n  wheel.prizes = prizes;\\n  \\n  wheel.onRotateFinished = (res) => {\\n    oCount.innerText = wheel.totalCount - wheel.count;\\n    if (res.type === 1) {\\n      oResult.innerHTML += `<li>${res.name}</li>`;\\n    }\\n  };\\n  \\n  wheel.init();\\n  window.addEventListener(\\\"resize\\\", function () {\\n    wheel.render();\\n  });\\n};\\n\\n\")), mdx(\"br\", null), mdx(\"h3\", null, \"\\u7279\\u522B\\u611F\\u8C22\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.cnblogs.com/whnba/p/10214312.html\"\n  }, \"Js \\u63A7\\u5236\\u968F\\u673A\\u6570\\u6982\\u7387\"), \" \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/MiuMiu-S/Draw-a-iottery\"\n  }, \"\\u56FE\\u7247\\u7D20\\u6750\\u6765\\u6E90\"), \"  \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://www.jianshu.com/p/66153577ce01\"\n  }, \"H5 Canvas\\u62BD\\u5956\\u5927\\u8F6C\\u76D8\\u4EE3\\u7801\\u5B9E\\u73B0\\u53CA\\u603B\\u7ED3\"))));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"date":"2020-06-15 16:57:55","title":"canvas 转盘抽奖","slug":"/blog/canvas-lucky-wheel"}}},"pageContext":{"slug":"/blog/canvas-lucky-wheel","next":"/blog/canvas-scratch-card","previous":"/blog/vue-menu-component"}},"staticQueryHashes":[]}