{"componentChunkName":"component---src-templates-blog-detail-js","path":"/blog/canvas-scratch-card","result":{"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"slug\": \"/blog/canvas-scratch-card\",\n  \"title\": \"canvas 实现刮刮卡\",\n  \"date\": \"2020-06-13 16:58:15\",\n  \"brief\": \"刮刮卡在移动端的应用中十分常见，此处利用 html5的新特性中的canvas实现了该功能。\",\n  \"tag\": \"h5\",\n  \"cover\": \"canvas-scratch-card-1.png\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h3\", null, \"\\u6548\\u679C\\u9884\\u89C8\"), mdx(\"p\", null, \"\\u522E\\u5F00\\u524D\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/canvas-scratch-card-1.png\",\n    \"alt\": \"效果图1：刮刮卡刮开前\"\n  })), mdx(\"p\", null, \"\\u522E\\u5F00\\u540E\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"/images/canvas-scratch-card-2.png\",\n    \"alt\": \"效果图2：刮刮卡刮开后\"\n  })), mdx(\"br\", null), mdx(\"h3\", null, \"\\u6838\\u5FC3\\u77E5\\u8BC6\\u70B9\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"\\u4F7F\\u7528 canvas \\u7684 \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"globalCompositeOperation\"), \" \\u5C5E\\u6027\\u5B9E\\u73B0\\u6D82\\u62B9\\u65F6\\u7684\\u522E\\u5F00\\u6548\\u679C\\uFF08\\u4E24\\u4E2A\\u56FE\\u50CF\\u7684\\u7EC4\\u5408\\uFF09\\u3002\"), mdx(\"table\", {\n    parentName: \"li\"\n  }, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u503C\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u63CF\\u8FF0\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"source-over\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u76EE\\u6807\\u56FE\\u50CF\\u4E0A\\u663E\\u793A\\u6E90\\u56FE\\u50CF\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"source-atop\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u76EE\\u6807\\u56FE\\u50CF\\u9876\\u90E8\\u663E\\u793A\\u6E90\\u56FE\\u50CF\\u3002\\u6E90\\u56FE\\u50CF\\u4F4D\\u4E8E\\u76EE\\u6807\\u56FE\\u50CF\\u4E4B\\u5916\\u7684\\u90E8\\u5206\\u662F\\u4E0D\\u53EF\\u89C1\\u7684\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"source-in\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u76EE\\u6807\\u56FE\\u50CF\\u4E2D\\u663E\\u793A\\u6E90\\u56FE\\u50CF\\u3002\\u53EA\\u6709\\u76EE\\u6807\\u56FE\\u50CF\\u5185\\u7684\\u6E90\\u56FE\\u50CF\\u90E8\\u5206\\u4F1A\\u663E\\u793A\\uFF0C\\u76EE\\u6807\\u56FE\\u50CF\\u662F\\u900F\\u660E\\u7684\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"source-out\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u76EE\\u6807\\u56FE\\u50CF\\u4E4B\\u5916\\u663E\\u793A\\u6E90\\u56FE\\u50CF\\u3002\\u53EA\\u4F1A\\u663E\\u793A\\u76EE\\u6807\\u56FE\\u50CF\\u4E4B\\u5916\\u6E90\\u56FE\\u50CF\\u90E8\\u5206\\uFF0C\\u76EE\\u6807\\u56FE\\u50CF\\u662F\\u900F\\u660E\\u7684\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"destination-over\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u6E90\\u56FE\\u50CF\\u4E0A\\u65B9\\u663E\\u793A\\u76EE\\u6807\\u56FE\\u50CF\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"destination-atop\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u6E90\\u56FE\\u50CF\\u9876\\u90E8\\u663E\\u793A\\u76EE\\u6807\\u56FE\\u50CF\\u3002\\u6E90\\u56FE\\u50CF\\u4E4B\\u5916\\u7684\\u76EE\\u6807\\u56FE\\u50CF\\u90E8\\u5206\\u4E0D\\u4F1A\\u88AB\\u663E\\u793A\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"destination-in\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u6E90\\u56FE\\u50CF\\u4E2D\\u663E\\u793A\\u76EE\\u6807\\u56FE\\u50CF\\u3002\\u53EA\\u6709\\u76EE\\u6807\\u56FE\\u50CF\\u5185\\u7684\\u6E90\\u56FE\\u50CF\\u90E8\\u5206\\u4F1A\\u663E\\u793A\\uFF0C\\u76EE\\u6807\\u56FE\\u50CF\\u662F\\u900F\\u660E\\u7684\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"destination-out\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u5728\\u76EE\\u6807\\u56FE\\u50CF\\u5916\\u663E\\u793A\\u6E90\\u56FE\\u50CF\\u3002\\u53EA\\u6709\\u6E90\\u56FE\\u50CF\\u5916\\u7684\\u76EE\\u6807\\u56FE\\u50CF\\u90E8\\u5206\\u4F1A\\u88AB\\u663E\\u793A\\uFF0C\\u6E90\\u56FE\\u50CF\\u662F\\u900F\\u660E\\u7684\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"lighter\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u663E\\u793A\\u6E90\\u56FE\\u50CF + \\u76EE\\u6807\\u56FE\\u50CF\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"copy\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u663E\\u793A\\u6E90\\u56FE\\u50CF\\u3002\\u5FFD\\u7565\\u76EE\\u6807\\u56FE\\u50CF\\u3002\\u53EA\\u6709\\u76EE\\u6807\\u56FE\\u50CF\\u5185\\u7684\\u6E90\\u56FE\\u50CF\\u90E8\\u5206\\u4F1A\\u663E\\u793A\\uFF0C\\u76EE\\u6807\\u56FE\\u50CF\\u662F\\u900F\\u660E\\u7684\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"xor\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"\\u4F7F\\u7528\\u5F02\\u6216\\u64CD\\u4F5C\\u5BF9\\u6E90\\u56FE\\u50CF\\u4E0E\\u76EE\\u6807\\u56FE\\u50CF\\u8FDB\\u884C\\u7EC4\\u5408\\u3002\\u53EA\\u6709\\u76EE\\u6807\\u56FE\\u50CF\\u5185\\u7684\\u6E90\\u56FE\\u50CF\\u90E8\\u5206\\u4F1A\\u663E\\u793A\\uFF0C\\u76EE\\u6807\\u56FE\\u50CF\\u662F\\u900F\\u660E\\u7684\")))))), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"\\u901A\\u8FC7 \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"getImageData\"), \" \\u83B7\\u53D6\\u753B\\u5E03\\u4E2D\\u6BCF\\u4E2A\\u50CF\\u7D20\\u70B9\\u7684\\u4FE1\\u606F\\uFF0C\\u4EE5\\u7EDF\\u8BA1\\u88AB\\u522E\\u5F00\\u7684\\u533A\\u57DF\\uFF0C\\u8FBE\\u5230\\u4E00\\u5B9A\\u6BD4\\u4F8B\\u65F6\\uFF0C\\u81EA\\u52A8\\u522E\\u5B8C\\u5269\\u4F59\\u90E8\\u5206\\u3002\")), mdx(\"br\", null), mdx(\"h3\", null, \"\\u6838\\u5FC3\\u4EE3\\u7801\"), mdx(\"p\", null, \"\\u9875\\u9762DOM\\u7ED3\\u6784\\uFF1A\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-html\"\n  }, \"<div id=\\\"box\\\" class=\\\"box\\\">\\n  <div class=\\\"prize\\\">\\u606D\\u559C\\u83B7\\u5F9710\\u79EF\\u5206</div>\\n  <canvas id=\\\"canvas\\\">\\u60A8\\u7684\\u6D4F\\u89C8\\u5668\\u4E0D\\u652F\\u6301canvas</canvas>\\n</div>\\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"class ScratchCard {\\n  constructor(oBox, oCanvas) {\\n    this.rem = Number.parseFloat(\\n      getComputedStyle(document.documentElement\\n    ).fontSize);\\n    \\n    // \\u753B\\u5E03\\u5143\\u7D20\\n    this._canvasElm = oCanvas;\\n    const styles = getComputedStyle(oBox),\\n          padding = Number.parseInt(styles.padding),\\n          borderWidth = Number.parseInt(styles.borderWidth);\\n    \\n    // \\u753B\\u5E03\\u5C3A\\u5BF8\\n    this.width = oBox.offsetWidth - padding * 2 - borderWidth * 2;\\n    this.height = oBox.offsetHeight - padding * 2 - borderWidth * 2;\\n    \\n    // \\u753B\\u5E03\\u4F4D\\u7F6E\\n    let obj = getOffsetToWindow(oCanvas);\\n    this.left = obj.left;\\n    this.top = obj.top;\\n    oCanvas.width = this.width;\\n    oCanvas.height = this.height;\\n    this.ctx = oCanvas.getContext(\\\"2d\\\");\\n    \\n    // \\u89E6\\u6478\\u4E8B\\u4EF6\\u76F8\\u5173\\u53C2\\u6570\\n    this.isTouching = false;\\n    this.touchedPointers = [];\\n  }\\n  \\n  drawLayerBg() {\\n    this.ctx.fillStyle = \\\"#ccc\\\";\\n    this.ctx.fillRect(0, 0, this.width, this.height);\\n  }\\n  \\n  drawLayerText() {\\n    this.ctx.fillStyle = \\\"#949494\\\";\\n    this.ctx.font = Number.parseInt(this.rem * 0.36) + \\\"px \\u9ED1\\u4F53\\\";\\n    this.ctx.textAlign = \\\"center\\\";\\n    this.ctx.textBaseline = \\\"middle\\\";\\n    this.ctx.fillText(\\\"\\u522E\\u5F00\\u6B64\\u6D82\\u5C42\\\", this.width / 2, this.height / 2);\\n  }\\n  \\n  drawBrush() {\\n    this.ctx.save();\\n    this.ctx.beginPath();\\n    this.ctx.moveTo(this.touchedPointers[0][0], this.touchedPointers[0][1]);\\n    this.ctx.lineCap = \\\"round\\\";\\n    this.ctx.lineJoin = \\\"round\\\";\\n    this.ctx.lineWidth = this.rem * 0.5;\\n    this.ctx.globalCompositeOperation = \\\"destination-out\\\";\\n    \\n    if (this.touchedPointers.length === 1) {\\n      this.ctx.moveTo(\\n        this.touchedPointers[0][0] + 1,\\n        this.touchedPointers[0][1] + 1\\n      );\\n    } else {\\n      for (var i = 0; i < this.touchedPointers.length; i++) {\\n        this.ctx.lineTo(this.touchedPointers[i][0], this.touchedPointers[i][1]);\\n        this.ctx.moveTo(this.touchedPointers[i][0], this.touchedPointers[i][1]);\\n      }\\n    }\\n    \\n    this.ctx.closePath();\\n    this.ctx.stroke();\\n    this.ctx.restore();\\n  }\\n  \\n  onTouchStart(e) {\\n    this.isTouching = true;\\n    let touchX = e.targetTouches[0].pageX - this.left,\\n        touchY = e.targetTouches[0].pageY - this.top;\\n    \\n    this.touchedPointers.push([touchX, touchY]);\\n    this.drawBrush();\\n  }\\n  \\n  onTouchMove(e) {\\n    if (this.isTouching) {\\n      let touchX = e.targetTouches[0].pageX - this.left,\\n          touchY = e.targetTouches[0].pageY - this.top;\\n      this.touchedPointers.push([touchX, touchY]);\\n      this.drawBrush();\\n      this.clearLayerBg(this.getFilledPercent());\\n    }\\n  }\\n  \\n  onTouchEnd() {\\n    this.isTouching = false;\\n    this.touchedPointers = [];\\n  }\\n  \\n  getFilledPercent() {\\n    // \\u8BA1\\u7B97\\u522E\\u8FC7\\u7684\\u533A\\u57DF\\u6240\\u5360\\u6BD4\\u4F8B\\n    const imgData = this.ctx.getImageData(0, 0, this.width, this.height);\\n    let pixels = imgData.data,\\n        brushedPixels = [];\\n    \\n    for (let i = 0, len = pixels.length; i < len; i += 4) {\\n      if (pixels[i + 3] < 128) {\\n        brushedPixels.push(pixels[i + 3]);\\n      }\\n    }\\n    \\n    return ((brushedPixels.length / (pixels.length / 4)) * 100).toFixed(2);\\n  }\\n  \\n  clearLayerBg(percent) {\\n    // \\u5230\\u8FBE\\u9608\\u503C\\u65F6\\u64E6\\u9664\\u6D82\\u5C42\\n    percent = percent || 0;\\n    if (percent >= 60) {\\n      this.ctx.clearRect(0, 0, this.width, this.height);\\n    }\\n  }\\n  \\n  render() {\\n    // \\u7ED8\\u5236\\u7070\\u8272\\u6D82\\u5C42\\u80CC\\u666F\\n    this.drawLayerBg();\\n    \\n    // \\u7ED8\\u5236\\u6D82\\u5C42\\u4E0A\\u7684\\u6587\\u672C\\n    this.drawLayerText();\\n  }\\n  \\n  init() {\\n    this.render();\\n    \\n    // \\u76D1\\u542C\\u4E8B\\u4EF6\\n    this._canvasElm.addEventListener(\\n      \\\"touchstart\\\",\\n      this.onTouchStart.bind(this)\\n    );\\n    this._canvasElm.addEventListener(\\n      \\\"touchmove\\\",\\n      this.onTouchMove.bind(this)\\n    );\\n    this._canvasElm.addEventListener(\\n      \\\"touchend\\\", this.onTouchEnd.bind(this));\\n  }\\n}\\n\\nwindow.onload = function () {\\n  const oBox = document.getElementById(\\\"box\\\"),\\n        oCanvas = document.getElementById(\\\"canvas\\\");\\n  \\n  let card = new ScratchCard(oBox, oCanvas);\\n  card.init();\\n};\\n\\nfunction getOffsetToWindow(el) {\\n  var offset = { left: 0, top: 0 };\\n  while (el !== document.body) {\\n    offset.left += el.offsetLeft;\\n    offset.top += el.offsetTop;\\n    el = el.offsetParent;\\n  }\\n  return offset;\\n}\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"date":"2020-06-13 16:58:15","title":"canvas 实现刮刮卡","slug":"/blog/canvas-scratch-card"}}},"pageContext":{"slug":"/blog/canvas-scratch-card","next":"/blog/travel-of-learning-RN","previous":"/blog/canvas-lucky-wheel"}},"staticQueryHashes":[]}